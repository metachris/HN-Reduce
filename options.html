<html>
<head><title>HN Reduce Extension Options</title></head>

<script type="text/javascript">
// Clear all removed items
function clear_all() {
    for (var key in localStorage) {
        localStorage.removeItem(key);
    }
    restore_options();
}

function restore(id, uri) {
    localStorage.removeItem(decodeURI(uri));
    localStorage.removeItem("_removed_" + id);
    restore_options();
}

// Restores select box state to saved value from localStorage.
function restore_options() {
    var items = Array();
    for (var key in localStorage) {
        if (key.substring(0, 9) == "_removed_") {
            items.push(localStorage[key]);
        }
    }    
    items.sort();
    items.reverse();
    
    document.getElementById("cnt").innerHTML = items.length;
        
    date_last = "";
    var x = document.getElementById("recent");
    x.innerHTML = "";
    for (var i in items) {
        id = items[i].substring(0, items[i].indexOf(","));
        items[i] = items[i].substring(items[i].indexOf(",")+1);
        date = items[i].substring(0, items[i].indexOf(","));
        items[i] = items[i].substring(items[i].indexOf(",")+1);
        
        content = "<small>[<a href='javascript:restore(\"" + id + "\", \"" + encodeURI(items[i]) + "\");'>restore</a>]</small>&nbsp;&nbsp;" + items[i] + "<br />";
        if (date != date_last) {
            content = "<hr><p><b>" + date + "</b></p>" + content;
            date_last = date;
        }
        x.innerHTML += content;
    }    
    
    /*
    var table = document.getElementById("recent");
    tbody = table.getElementsByTagName("tbody")[0];
    table.removeChild(tbody);
    
    tbody = document.createElement("tbody");
    
    for (var i in items) {
        tr = document.createElement("tr");
        
        td = document.createElement("td");
        td.innerHTML = items[i];
        td.style.width="500px";
        tr.appendChild(td);
        
        td = document.createElement("td");
        td.innerHTML = "restore";
        td.style.vAlign = "top";
        tr.appendChild(td);
        
        tbody.appendChild(tr);
    }
    table.appendChild(tbody);
    */
}

</script>

<body onload="restore_options()">

<h2>HN Reduce Extension Options</h2>

<h3>Removed Stories: <span id="cnt"></span></h3>

<p><div id="recent"></div></p>
<!--
<table id="recent" style="margin:10px;">
</table>
-->

<hr>
<button onclick="clear_all()">Clear All</button>
</body>
</html>